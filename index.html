<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>–ü–∞—Ä—ã ‚Ä¢ –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞</title>
<style>
  :root{
    /* –†–∞–∑–º–µ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥ —ç–∫—Ä–∞–Ω */
    --tile: clamp(72px, 20vw, 108px);
    --r: 26px;

    --bg1:#eef6ff;
    --bg2:#fff0fb;
    --card:#ffffff;
    --text:#0b1630;
    --muted:#52607d;
    --stroke:rgba(0,0,0,.08);
    --shadow: 0 18px 44px rgba(12,24,64,.12);

    --blue:#2f7dff;
    --pink:#ff3fbf;
    --mint:#12d98a;
    --sun:#ffb300;
    --violet:#7c5cff;
  }

  *{ box-sizing:border-box; }
  html,body{ height:100%; }
  body{
    margin:0;
    font: 16px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    color:var(--text);
    background:
      radial-gradient(1200px 800px at 12% 10%, rgba(47,125,255,.18), transparent 60%),
      radial-gradient(900px 700px at 92% 18%, rgba(255,63,191,.16), transparent 62%),
      radial-gradient(900px 700px at 55% 95%, rgba(18,217,138,.14), transparent 62%),
      linear-gradient(135deg, var(--bg1), var(--bg2));
    padding: clamp(14px, 3vw, 22px);
    display:flex;
    justify-content:center;
    align-items:stretch;
  }

  /* –õ—ë–≥–∫–∏–µ "–ø—É–∑—ã—Ä—å–∫–∏" –Ω–∞ —Ñ–æ–Ω–µ */
  .bubbles{
    position: fixed;
    inset: 0;
    pointer-events:none;
    overflow:hidden;
    z-index: 0;
  }
  .bubble{
    position:absolute;
    width: 240px; height: 240px;
    border-radius: 50%;
    filter: blur(2px);
    opacity: .22;
    animation: drift 12s ease-in-out infinite;
  }
  .bubble.b1{ left:-60px; top:80px; background: radial-gradient(circle at 30% 30%, rgba(47,125,255,.9), rgba(47,125,255,0)); }
  .bubble.b2{ right:-80px; top:40px; background: radial-gradient(circle at 40% 40%, rgba(255,63,191,.9), rgba(255,63,191,0)); animation-duration: 14s;}
  .bubble.b3{ left:30%; bottom:-110px; background: radial-gradient(circle at 35% 35%, rgba(18,217,138,.9), rgba(18,217,138,0)); animation-duration: 16s;}
  @keyframes drift{
    0%,100%{ transform: translateY(0) translateX(0) scale(1); }
    50%{ transform: translateY(-30px) translateX(20px) scale(1.06); }
  }

  /* –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ */
  .confetti{
    position:fixed; inset:0;
    pointer-events:none;
    overflow:hidden;
    display:none;
    z-index: 30;
  }
  .confetti.on{ display:block; }
  .piece{
    position:absolute;
    width:10px; height:16px;
    border-radius: 4px;
    opacity:.9;
    animation: fall 900ms linear infinite;
  }
  @keyframes fall{
    from{ transform: translateY(-20px) rotate(0deg); }
    to{ transform: translateY(calc(100vh + 40px)) rotate(220deg); }
  }

  /* –õ–æ–∞–¥–µ—Ä */
  .loader{
    position:fixed; inset:0;
    display:none;
    align-items:center;
    justify-content:center;
    background: rgba(255,255,255,.55);
    backdrop-filter: blur(10px);
    z-index: 40;
  }
  .loader.on{ display:flex; }
  .loaderCard{
    background: rgba(255,255,255,.92);
    border: 1px solid rgba(0,0,0,.10);
    border-radius: 22px;
    box-shadow: 0 18px 40px rgba(12,24,64,.16);
    padding: 16px 18px;
    display:flex;
    gap:14px;
    align-items:center;
    width: min(420px, 92vw);
  }
  .spinner{
    width:34px; height:34px;
    border-radius: 999px;
    border: 5px solid rgba(47,125,255,.22);
    border-top-color: rgba(255,63,191,.65);
    border-right-color: rgba(18,217,138,.55);
    animation: spin 900ms linear infinite;
  }
  @keyframes spin{ to{ transform: rotate(360deg); } }
  .loaderTitle{ font-weight: 900; font-size: 16px; }
  .loaderSub{ color: var(--muted); font-size: 13px; margin-top: 2px; }

  /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
  .app{
    width:min(1100px, 100%);
    display:grid;
    grid-template-columns: 360px 1fr;
    gap: clamp(12px, 2.2vw, 18px);
    align-items: stretch; /* –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è –≤—ã—Å–æ—Ç–∞ –∫–æ–ª–æ–Ω–æ–∫ */
    min-height: min(760px, calc(100vh - 2*clamp(14px, 3vw, 22px)));
    position:relative;
    z-index: 1;
  }
  @media (max-width: 920px){
    .app{
      grid-template-columns: 1fr;
      min-height: unset;
    }
    .panel-board{ min-height: auto; }
    .boardWrap{ padding: 12px; }
  }

  .panel{
    background: rgba(255,255,255,.90);
    border:1px solid var(--stroke);
    border-radius: var(--r);
    box-shadow: var(--shadow);
    padding:18px;
    backdrop-filter: blur(10px);
    position:relative;
    overflow:hidden;
    display:flex;
    flex-direction: column;
  }
  .panel::before{
    content:"";
    position:absolute;
    inset:0;
    pointer-events:none;
    background:
      radial-gradient(12px 12px at 10% 16%, rgba(255,179,0,.18), transparent 60%),
      radial-gradient(10px 10px at 90% 22%, rgba(255,63,191,.16), transparent 60%),
      radial-gradient(10px 10px at 24% 78%, rgba(18,217,138,.14), transparent 60%),
      radial-gradient(10px 10px at 78% 86%, rgba(47,125,255,.14), transparent 60%),
      radial-gradient(420px 260px at 20% 0%, rgba(47,125,255,.10), transparent 60%),
      radial-gradient(420px 260px at 95% 15%, rgba(255,63,191,.10), transparent 60%),
      radial-gradient(420px 260px at 70% 110%, rgba(18,217,138,.10), transparent 60%);
    opacity:.9;
    mix-blend-mode: multiply;
  }

  .panel-menu{
    background:
      radial-gradient(420px 260px at 15% 5%, rgba(47,125,255,.18), transparent 60%),
      radial-gradient(420px 260px at 95% 18%, rgba(255,63,191,.16), transparent 62%),
      radial-gradient(420px 260px at 50% 105%, rgba(18,217,138,.14), transparent 62%),
      rgba(255,255,255,.92);
  }
  .panel-board{
    background:
      radial-gradient(600px 340px at 15% 5%, rgba(47,125,255,.10), transparent 60%),
      radial-gradient(600px 340px at 95% 18%, rgba(255,63,191,.10), transparent 62%),
      radial-gradient(600px 340px at 50% 105%, rgba(18,217,138,.08), transparent 62%),
      rgba(255,255,255,.90);
  }

  .ribbon{
    align-self:flex-start;
    padding:6px 12px;
    border-radius: 999px;
    font-weight: 900;
    font-size: 12px;
    color: rgba(11,22,48,.78);
    background: rgba(255,255,255,.78);
    border: 1px solid rgba(0,0,0,.08);
    box-shadow: 0 12px 20px rgba(12,24,64,.10);
    margin-bottom: 10px;
  }

  .titleRow{ display:flex; gap:12px; align-items:center; margin-bottom:10px; }
  .logo{
    width:56px;
    height:56px;
    border-radius: 20px;
    background:
      radial-gradient(22px 22px at 30% 30%, rgba(255,255,255,.85), transparent 60%),
      linear-gradient(135deg, rgba(255,179,0,.18), rgba(255,63,191,.14), rgba(47,125,255,.14));
    box-shadow: 0 18px 34px rgba(12,24,64,.14);
    padding:8px;
    display:grid;
    place-items:center;
  }
  .logo svg{ width:100%; height:100%; }

  .gameTitle{
    font-size: 26px;
    margin:0;
    letter-spacing:.2px;
    font-weight: 1000;
    background: linear-gradient(90deg, rgba(47,125,255,.98), rgba(255,63,191,.92), rgba(18,217,138,.92));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    text-shadow: 0 10px 22px rgba(12,24,64,.12);
  }
  .sub{
    margin-top:6px;
    font-size: 15px;
    color: rgba(33,46,79,.82);
    font-weight: 650;
  }

  label{
    color: rgba(33,46,79,.72);
    font-size: 13px;
    font-weight: 800;
    display:block;
    margin:14px 0 8px;
    letter-spacing:.2px;
  }
  select{
    width:100%;
    padding:12px 12px;
    border-radius: 14px;
    border: 2px solid rgba(47,125,255,.18);
    background: rgba(255,255,255,.92);
    font-size: 15px;
    outline:none;
    box-shadow: 0 14px 22px rgba(12,24,64,.08);
  }
  select:focus{
    border-color: rgba(255,63,191,.35);
    box-shadow: 0 0 0 6px rgba(255,63,191,.12), 0 14px 22px rgba(12,24,64,.08);
  }
  #levelTip{
    margin-top:8px;
    color: rgba(33,46,79,.72);
    font-weight: 700;
  }

  .btns{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-top:14px; }
  button{
    font: inherit;
    border:none;
    border-radius: 16px;
    padding:12px 12px;
    cursor:pointer;
    box-shadow: 0 14px 26px rgba(12,24,64,.12);
    transition: transform .12s ease, filter .12s ease;
  }
  button:active{ transform: translateY(1px) scale(.99); }

  .primary{
    background: linear-gradient(135deg, rgba(47,125,255,.96), rgba(255,63,191,.86), rgba(18,217,138,.82));
    color:#061028;
    font-weight: 900;
  }
  .secondary{
    background: rgba(255,255,255,.92);
    border:1px solid rgba(0,0,0,.10);
    box-shadow: 0 12px 24px rgba(12,24,64,.10);
    font-weight: 800;
  }

  .stats{
    margin-top:14px;
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:10px;
  }
  .stat{
    background: rgba(255,255,255,.90);
    border:1px solid rgba(0,0,0,.08);
    border-radius: 16px;
    padding:10px 12px;
    box-shadow: 0 10px 18px rgba(12,24,64,.08);
  }
  .stat small{ color: rgba(33,46,79,.70); font-weight: 800; display:block; }
  .stat b{ font-size: 20px; color: rgba(11,22,48,.92); }

  .hint{
    margin-top:12px;
    border-radius: 16px;
    background: linear-gradient(135deg, rgba(255,179,0,.10), rgba(47,125,255,.08), rgba(18,217,138,.08));
    border: 1px solid rgba(255,179,0,.20);
    padding:12px 12px;
    color: rgba(33,46,79,.82);
    font-size: 13px;
  }

  .footer{
    margin-top:auto;
    font-size: 12px;
    color: rgba(82,96,125,.9);
    padding-top: 10px;
  }
  .footer a{ color: rgba(47,125,255,.95); text-decoration:none; }
  .footer a:hover{ text-decoration: underline; }

  /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —Å–ø—Ä–∞–≤–∞ */
  .topbar{
    display:flex;
    gap:10px;
    align-items:center;
    justify-content:space-between;
    padding:14px 16px;
    margin-bottom:12px;
    border-radius: 22px;
    background: rgba(255,255,255,.55);
    border: 1px solid rgba(0,0,0,.06);
    box-shadow: inset 0 0 0 3px rgba(255,255,255,.55);
  }
  .pill{
    display:inline-flex; align-items:center; gap:8px;
    padding:8px 10px;
    border-radius: 999px;
    border:1px solid rgba(0,0,0,.10);
    background: rgba(255,255,255,.86);
    color: var(--muted);
    font-size: 14px;
    white-space: nowrap;
  }
  .dot{
    width:10px; height:10px; border-radius:999px;
    background: var(--mint);
    box-shadow: 0 0 0 4px rgba(18,217,138,.18);
  }
  .reset{
    padding:10px 14px;
    border-radius: 999px;
    font-weight: 900;
    background: linear-gradient(135deg, rgba(255,63,191,.92), rgba(255,179,0,.88));
    box-shadow: 0 18px 30px rgba(255,63,191,.18);
  }

  /* –ü—Ä–æ–≥—Ä–µ—Å—Å */
  .progressWrap{ padding: 0 16px 14px; }
  .progressBar{
    height: 14px;
    border-radius: 999px;
    background: rgba(0,0,0,.06);
    border: 1px solid rgba(0,0,0,.08);
    overflow:hidden;
    box-shadow: inset 0 0 0 3px rgba(255,255,255,.55);
  }
  .progressFill{
    height: 100%;
    width: 0%;
    border-radius: 999px;
    background: linear-gradient(90deg, rgba(47,125,255,.95), rgba(255,63,191,.85), rgba(18,217,138,.85));
    transition: width .25s ease;
  }
  .progressText{
    margin-top: 8px;
    color: var(--muted);
    font-weight: 900;
  }

  /* –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ */
  .boardWrap{
    padding:16px;
    flex:1;
    display:flex;
    flex-direction:column;
    min-height: 0;
  }

  .grid{
    --cols: 4;
    display:grid;
    gap: clamp(10px, 2.2vw, 14px);
    grid-template-columns: repeat(var(--cols), minmax(0, 1fr));
    align-content:start;
    justify-items: stretch;
    width: 100%;
    max-width: 820px;
    margin: 0 auto;
  }

  /* –ù–∞ –æ—á–µ–Ω—å —É–∑–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö (—Ç–µ–ª–µ—Ñ–æ–Ω) —É–º–µ–Ω—å—à–∞–µ–º —Å—Ç–æ–ª–±—Ü—ã –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ */
  @media (max-width: 520px){
    .grid{ --cols: 3; }
    .btns{ grid-template-columns: 1fr; }
    .gameTitle{ font-size: 24px; }
  }

  /* Flip-–∫–∞—Ä—Ç–æ—á–∫–∞ */
  .card{
    width: 100%;
    aspect-ratio: 1 / 1;
    position:relative;
    border-radius: 20px;
    background: transparent;
    border:none;
    box-shadow:none;
    cursor:pointer;
    padding:0;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }
  .inner{
    position:absolute; inset:0;
    border-radius: 20px;
    transform-style: preserve-3d;
    transition: transform .38s cubic-bezier(.2,.8,.2,1);
    box-shadow: 0 14px 26px rgba(12,24,64,.14);
  }
  .card:focus-visible .inner{
    outline: 3px solid rgba(47,125,255,.45);
    outline-offset: 2px;
  }
  .face{
    position:absolute; inset:0;
    border-radius: 20px;
    backface-visibility:hidden;
    -webkit-backface-visibility:hidden;
    overflow:hidden;
    border:1px solid rgba(0,0,0,.10);
  }
  .front{
    background:
      radial-gradient(120px 90px at 18% 20%, rgba(47,125,255,.26), transparent 60%),
      radial-gradient(120px 90px at 85% 85%, rgba(255,63,191,.22), transparent 62%),
      linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.82));
    display:grid;
    place-items:center;
  }
  .badge{
    width:64%;
    aspect-ratio:1/1;
    border-radius: 18px;
    border:2px solid rgba(47,125,255,.18);
    background:
      radial-gradient(18px 18px at 30% 30%, rgba(255,255,255,.95), transparent 60%),
      linear-gradient(135deg, rgba(47,125,255,.16), rgba(255,63,191,.14), rgba(18,217,138,.12));
    box-shadow: inset 0 0 0 3px rgba(255,255,255,.72), 0 12px 20px rgba(12,24,64,.12);
    transform: rotate(10deg);
    display:grid;
    place-items:center;
    font-weight: 1000;
    color: rgba(11,22,48,.72);
    user-select:none;
    position:relative;
  }
  .badge::before{
    content:"‚ú®";
    position:absolute;
    top:-10px; right:-10px;
    font-size: 18px;
    filter: drop-shadow(0 8px 10px rgba(0,0,0,.12));
  }

  .back{
    transform: rotateY(180deg);
    background: rgba(255,255,255,.96);
    display:grid;
    place-items:center;
    position:relative;
  }

  .icon{
    width: 92%;
    height: 92%;
    display:grid;
    place-items:center;
    filter: drop-shadow(0 10px 14px rgba(0,0,0,.18));
  }
  .icon img{
    width: 100%;
    height: 100%;
    object-fit: contain;
    user-select:none;
    -webkit-user-drag:none;
  }

  .card.flipped .inner{ transform: rotateY(180deg); }

  /* –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø–∞—Ä—ã: –≤—Å–µ–≥–¥–∞ –æ—Ç–∫—Ä—ã—Ç—ã (–Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ) */
  .card.matched{ cursor: default; }
  .card.matched .inner{ transform: rotateY(180deg) !important; }
  .card.matched .inner::after{
    content:"";
    position:absolute; inset:-2px;
    border-radius: 22px;
    background:
      radial-gradient(10px 10px at 20% 22%, rgba(255,255,255,.9), transparent 60%),
      radial-gradient(10px 10px at 78% 35%, rgba(255,255,255,.75), transparent 60%),
      conic-gradient(from 180deg, rgba(255,63,191,.0), rgba(255,63,191,.22), rgba(18,217,138,.22), rgba(47,125,255,.0));
    mix-blend-mode: multiply;
    pointer-events:none;
    opacity:.55;
  }

  /* –ü–æ–¥—Å–∫–∞–∑–∫–∞/—Å–æ–æ–±—â–µ–Ω–∏–µ —Å–Ω–∏–∑—É */
  .toast{
    margin-top:auto;
    margin-inline:auto;
    width: min(820px, 100%);
    border-radius: 18px;
    border:1px solid rgba(0,0,0,.08);
    background: rgba(255,255,255,.86);
    padding:10px 12px;
    color: var(--muted);
    position:relative;
  }
  .toast::before{
    content:"";
    position:absolute;
    left:24px;
    top:-8px;
    width:16px;
    height:16px;
    background: rgba(255,255,255,.86);
    border-left:1px solid rgba(0,0,0,.08);
    border-top:1px solid rgba(0,0,0,.08);
    transform: rotate(45deg);
  }
  .toast b{ color: var(--text); }

  /* Hover –¥–ª—è –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ */
  @media (hover:hover){
    .card:hover .inner{ transform: translateY(-3px) rotateZ(-0.4deg); }
    .card.flipped:hover .inner{ transform: rotateY(180deg) translateY(-3px); }
  }
  .card:active .inner{ transform: translateY(0) scale(.99); }

  /* Mobile safety: –Ω–µ –ø—Ä—è—á–µ–º –ø–æ–ª–µ, –¥–∞–∂–µ –µ—Å–ª–∏ —Å–µ—Ç–∫–∞ —à–∏—Ä–µ */
  .panel-board{ overflow: visible; }
  .boardWrap{ overflow: visible; }


  #grid{ width: 100%; max-width: 100%; }

</style>
</head>
<body>
  <div class="bubbles" aria-hidden="true">
    <div class="bubble b1"></div><div class="bubble b2"></div><div class="bubble b3"></div>
  </div>

  <div class="confetti" id="confetti" aria-hidden="true"></div>

  <div class="loader" id="loader" role="status" aria-live="polite">
    <div class="loaderCard">
      <div class="spinner" aria-hidden="true"></div>
      <div>
        <div class="loaderTitle">–ó–∞–≥—Ä—É–∂–∞—é –∫–∞—Ä—Ç–∏–Ω–∫–∏‚Ä¶</div>
        <div class="loaderSub" id="loaderSub">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–≥—Ä—ã</div>
      </div>
    </div>
  </div>

  <main class="app" aria-label="–ò–≥—Ä–∞ –ü–∞—Ä—ã ‚Ä¢ –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞">
    <section class="panel panel-menu">
      <div class="ribbon" aria-hidden="true">üéÆ –ò–≥—Ä–æ–≤–æ–µ –º–µ–Ω—é</div>

      <div class="titleRow">
        <div class="logo" aria-hidden="true">
          <!-- –º–∏–ª—ã–π –ª–æ–≥–æ—Ç–∏–ø-–∑–≤–µ–∑–¥–∞ -->
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128">
            <defs>
              <linearGradient id="st" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stop-color="#ffb300"/>
                <stop offset="0.45" stop-color="#ff3fbf"/>
                <stop offset="1" stop-color="#2f7dff"/>
              </linearGradient>
              <filter id="ds" x="-30%" y="-30%" width="160%" height="160%">
                <feDropShadow dx="0" dy="6" stdDeviation="6" flood-color="rgba(0,0,0,.18)"/>
              </filter>
            </defs>
            <g filter="url(#ds)">
              <path d="M64 14l14.2 29.2 32.2 4.7-23.2 22.6 5.5 32-28.7-15.1-28.7 15.1 5.5-32L17.6 47.9l32.2-4.7L64 14z"
                    fill="url(#st)" stroke="rgba(255,255,255,.85)" stroke-width="6" stroke-linejoin="round"/>
              <path d="M64 26l9.2 18.9 20.9 3-15.1 14.7 3.6 20.8L64 73.7 45.4 83.4 49 62.6 33.9 47.9l20.9-3L64 26z"
                    fill="rgba(255,255,255,.22)"/>
              <circle cx="44" cy="30" r="6" fill="rgba(255,255,255,.75)"/>
            </g>
          </svg>
        </div>

        <div>
          <h1 class="gameTitle">–ü–∞—Ä—ã ‚Ä¢ –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞</h1>
          <div class="sub">–ù–∞–π–¥–∏ –≤—Å–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–º–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏.</div>
        </div>
      </div>

      <label for="sizeSel">–í—ã–±–µ—Ä–∏ —É—Ä–æ–≤–µ–Ω—å</label>
      <select id="sizeSel" aria-label="–í—ã–±–µ—Ä–∏ —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏">
        <option value="4">4√ó4 (8 –ø–∞—Ä)</option>
        <option value="5">5√ó4 (10 –ø–∞—Ä)</option>
        <option value="6">6√ó4 (12 –ø–∞—Ä)</option>
      </select>
      <div id="levelTip">üß© –ß–µ–º –±–æ–ª—å—à–µ –ø–æ–ª–µ ‚Äî —Ç–µ–º —Å–ª–æ–∂–Ω–µ–µ –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–µ!</div>

      <div class="btns">
        <button class="primary" id="newBtn" type="button">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
        <button class="secondary" id="hintBtn" type="button">–ü–æ–¥—Å–∫–∞–∑–∫–∞ (2 —Å–µ–∫)</button>
      </div>

      <div class="stats" aria-label="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞">
        <div class="stat"><small>–í—Ä–µ–º—è</small><b id="time">00:00</b></div>
        <div class="stat"><small>–•–æ–¥—ã</small><b id="moves">0</b></div>
        <div class="stat"><small>–ü–∞—Ä—ã</small><b id="pairs">0/0</b></div>
        <div class="stat"><small>–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</small><b id="best">‚Äî</b></div>
      </div>

      <div class="hint">
        <b>–ö–∞–∫ –∏–≥—Ä–∞—Ç—å:</b> –Ω–∞–∂–∏–º–∞–π –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∏. –ù–∞–π–¥–∏ –ø–∞—Ä—É ‚Äî –æ–Ω–∞ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç–æ–π.<br/>
        –ü–æ–¥—Å–∫–∞–∑–∫–∞ –Ω–∞ 2 —Å–µ–∫—É–Ω–¥—ã –ø–æ–∫–∞–∂–µ—Ç –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏.
      </div>

      <div class="footer">
        –ò–∫–æ–Ω–∫–∏: <a href="https://icons8.ru/icons/" target="_blank" rel="noopener">Icons8</a> (—Å—Ç–∏–ª—å Color).
      </div>
    </section>

    <section class="panel panel-board">
      <div class="topbar">
        <span class="pill"><span class="dot" aria-hidden="true"></span>–ì–æ—Ç–æ–≤–æ</span>
        <button class="reset" id="resetBest" type="button" title="–°–±—Ä–æ—Å–∏—Ç—å –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç">–°–±—Ä–æ—Å–∏—Ç—å —Ä–µ–∫–æ—Ä–¥</button>
      </div>

      <div class="progressWrap" aria-hidden="true">
        <div class="progressBar"><div class="progressFill" id="progress"></div></div>
        <div class="progressText" id="progressText">–ü–∞—Ä—ã: 0/0</div>
      </div>

      <div class="boardWrap">
        <div class="grid" id="grid" aria-label="–ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ"></div>
        <div class="toast" id="toast" aria-live="polite">–û—Ç–∫—Ä–æ–π –¥–≤–µ –∫–∞—Ä—Ç–æ—á–∫–∏ üôÇ</div>
      </div>
    </section>
  </main>

<script>
(() => {
  // –ò–∫–æ–Ω–∫–∏ (Icons8). –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è, –≤–∫–ª—é—á–∞–µ—Ç—Å—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π fallback.
  const makeFallback = (label) => {
    const svg = `
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128">
        <defs>
          <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0" stop-color="#2f7dff"/>
            <stop offset="0.5" stop-color="#ff3fbf"/>
            <stop offset="1" stop-color="#12d98a"/>
          </linearGradient>
        </defs>
        <rect x="14" y="14" width="100" height="100" rx="26" fill="url(#g)" opacity="0.9"/>
        <circle cx="44" cy="42" r="10" fill="rgba(255,255,255,0.75)"/>
        <path d="M64 30l10 20 22 3-16 15 4 22-20-10-20 10 4-22-16-15 22-3z" fill="rgba(255,255,255,0.22)"/>
        <text x="64" y="82" text-anchor="middle" font-family="system-ui,Segoe UI,Arial" font-size="34" font-weight="900" fill="rgba(255,255,255,0.92)">${label}</text>
      </svg>`;
    return "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svg);
  };

  // –ò–∫–æ–Ω–∫–∏ (Icons8). –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è, –≤–∫–ª—é—á–∞–µ—Ç—Å—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π fallback.
  const ICONS = [
    {name:'–ú–æ–Ω–∏—Ç–æ—Ä', url:'https://img.icons8.com/color/96/monitor.png', label:'M'},
    {name:'–ü—Ä–∏–Ω—Ç–µ—Ä', url:'https://img.icons8.com/color/96/printer.png', label:'P'},
    {name:'–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞', url:'https://img.icons8.com/color/96/keyboard.png', label:'K'},
    {name:'–ú—ã—à—å', url:'https://img.icons8.com/color/96/mouse.png', label:'Œº'},
    {name:'–ù–æ—É—Ç–±—É–∫', url:'https://img.icons8.com/color/96/laptop.png', label:'L'},
    {name:'–°–º–∞—Ä—Ç—Ñ–æ–Ω', url:'https://img.icons8.com/color/96/smartphone-tablet.png', label:'S'},
    {name:'Wi‚ÄëFi', url:'https://img.icons8.com/color/96/wifi.png', label:'W'},
    {name:'USB', url:'https://img.icons8.com/color/96/usb-connector.png', label:'U'},
    {name:'–û–±–ª–∞–∫–æ', url:'https://img.icons8.com/color/96/cloud.png', label:'C'},
    {name:'–°–µ—Ä–≤–µ—Ä', url:'https://img.icons8.com/color/96/server.png', label:'SV'},
    {name:'–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö', url:'https://img.icons8.com/color/96/database.png', label:'DB'},
    {name:'–ö–æ–¥', url:'https://img.icons8.com/color/96/source-code.png', label:'</>'},
    {name:'–ü–∞–ø–∫–∞', url:'https://img.icons8.com/color/96/folder-invoices.png', label:'F'},
    {name:'–®–µ—Å—Ç–µ—Ä—ë–Ω–∫–∏', url:'https://img.icons8.com/color/96/settings.png', label:'‚öô'},
    {name:'–ö–∞–º–µ—Ä–∞', url:'https://img.icons8.com/color/96/video-camera.png', label:'V'},
    {name:'–ù–∞—É—à–Ω–∏–∫–∏', url:'https://img.icons8.com/color/96/headphones.png', label:'‚ô´'}
  ];

  const $ = (s, el=document) => el.querySelector(s);
  const $$ = (s, el=document) => Array.from(el.querySelectorAll(s));
  const grid = $("#grid");
  const sizeSel = $("#sizeSel");
  const newBtn = $("#newBtn");
  const hintBtn = $("#hintBtn");
  const timeEl = $("#time");
  const movesEl = $("#moves");
  const pairsEl = $("#pairs");
  const bestEl = $("#best");
  const toast = $("#toast");
  const resetBest = $("#resetBest");
  const confetti = $("#confetti");
  const loader = $("#loader");
  const loaderSub = $("#loaderSub");
  const progressFill = $("#progress");
  const progressText = $("#progressText");

  let timer = null;
  let startTs = null;
  let moves = 0;
  let matched = 0;
  let totalPairs = 0;
  let lock = false;
  let opened = [];
  let cards = [];

  const pad2 = (n) => String(n).padStart(2,"0");
  const formatTime = (sec) => `${pad2(Math.floor(sec/60))}:${pad2(sec%60)}`;

  function stopTimer(){ if(timer){ clearInterval(timer); timer=null; } }
  function startTimer(){
    stopTimer();
    startTs = Date.now();
    timer = setInterval(() => {
      const sec = Math.floor((Date.now() - startTs)/1000);
      timeEl.textContent = formatTime(sec);
    }, 250);
  }

  function bestKey(){ return `pairs_best_${sizeSel.value}x4`; }
  function readBest(){
    const raw = localStorage.getItem(bestKey());
    if(!raw) return null;
    try{ return JSON.parse(raw); } catch { return null; }
  }
  function writeBest(obj){ localStorage.setItem(bestKey(), JSON.stringify(obj)); }
  function showBest(){
    const b = readBest();
    bestEl.textContent = b ? `${b.moves} —Ö–æ–¥–æ–≤ ‚Ä¢ ${formatTime(b.time)}` : "‚Äî";
  }

  function setToast(msg){ toast.innerHTML = msg; }

  function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]] = [arr[j],arr[i]];
    }
    return arr;
  }

  function buildDeck(cols){
    const count = cols*4;
    totalPairs = Math.floor(count/2);

    const chosen = ICONS.slice();
    shuffle(chosen);
    const icons = chosen.slice(0, totalPairs);

    const deck = [];
    let id = 0;
    for(const icon of icons){
      deck.push({ id: id++, icon });
      deck.push({ id: id++, icon });
    }
    shuffle(deck);
    return deck;
  }

  function updateProgressUI(){
    const pct = totalPairs ? Math.round((matched/totalPairs)*100) : 0;
    progressFill.style.width = pct + "%";
    progressText.textContent = `–ü–∞—Ä—ã: ${matched}/${totalPairs}`;
  }

  async function preloadIcons(icons){
    loader.classList.add("on");
    const unique = Array.from(new Map(icons.map(x => [x.url, x])).values());
    let done = 0;

    const loadOne = (ic) => new Promise((resolve) => {
      const im = new Image();
      im.onload = () => resolve(true);
      im.onerror = () => resolve(false);
      im.src = ic.url;
    });

    for(const ic of unique){
      loaderSub.textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ: ${done}/${unique.length}`;
      await loadOne(ic); // –¥–∞–∂–µ –µ—Å–ª–∏ –æ—à–∏–±–∫–∞ ‚Äî —É –Ω–∞—Å –µ—Å—Ç—å fallback
      done += 1;
    }
    loaderSub.textContent = `–ì–æ—Ç–æ–≤–æ: ${done}/${unique.length}`;
    setTimeout(() => loader.classList.remove("on"), 220);
  }

  function render(){
    const cols = Number(sizeSel.value);

    // –ï—Å–ª–∏ —ç–∫—Ä–∞–Ω —É–∑–∫–∏–π ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º 3 –∫–æ–ª–æ–Ω–∫–∏, –∏–Ω–∞—á–µ —Å—Ç–æ–ª—å–∫–æ, —Å–∫–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    const effectiveCols = (window.matchMedia("(max-width: 520px)").matches) ? 3 : cols;
    grid.style.setProperty("--cols", String(effectiveCols));

    grid.innerHTML = "";
    cards.forEach((c, idx) => {
      const btn = document.createElement("button");
      btn.className = "card";
      btn.type = "button";
      btn.dataset.i = String(idx);

      const inner = document.createElement("div");
      inner.className = "inner";

      const front = document.createElement("div");
      front.className = "face front";
      const badge = document.createElement("div");
      badge.className = "badge";
      badge.textContent = "‚òÖ";
      front.appendChild(badge);

      const back = document.createElement("div");
      back.className = "face back";
      const icon = document.createElement("div");
      icon.className = "icon";
      const img = document.createElement("img");
      img.src = c.icon.url;
      img.alt = c.icon.name;
      img.loading = "lazy";
      img.decoding = "async";
      img.addEventListener("error", () => { img.src = makeFallback(c.icon.label || '‚òÖ'); });
      icon.appendChild(img);
      back.appendChild(icon);

      inner.appendChild(front);
      inner.appendChild(back);
      btn.appendChild(inner);

      if(opened.includes(idx)) btn.classList.add("flipped");
      if(c._matched){
        btn.classList.add("matched", "flipped");
        btn.disabled = true; // —á—Ç–æ–±—ã –Ω–µ–ª—å–∑—è –±—ã–ª–æ –∫–ª–∏–∫–∞—Ç—å —Å–Ω–æ–≤–∞, –Ω–æ –æ—Å—Ç–∞—ë—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º
      } else {
        btn.addEventListener("click", () => onFlip(idx));
      }

      grid.appendChild(btn);
    });
  }

  function onFlip(i){
    if(lock) return;
    const c = cards[i];
    if(c._matched) return;
    if(opened.includes(i)) return;

    if(moves === 0 && matched === 0 && !timer) startTimer();

    opened.push(i);
    render();

    if(opened.length < 2){
      setToast("–û—Ç–∫—Ä–æ–π –µ—â—ë –æ–¥–Ω—É üôÇ");
      return;
    }

    moves += 1;
    movesEl.textContent = String(moves);

    const [a,b] = opened;
    const ca = cards[a], cb = cards[b];

    if(ca.icon.url === cb.icon.url){
      ca._matched = true;
      cb._matched = true;
      matched += 1;

      pairsEl.textContent = `${matched}/${totalPairs}`;
      updateProgressUI();

      opened = [];
      setToast("–°—É–ø–µ—Ä! –ù–∞—à–ª–∞—Å—å –ø–∞—Ä–∞ ‚ú®");
      render();

      if(matched === totalPairs) finish();
      return;
    }

    lock = true;
    setToast("–≠—Ç–æ —Ä–∞–∑–Ω—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ üôà");
    setTimeout(() => {
      opened = [];
      lock = false;
      render();
      setToast("–û—Ç–∫—Ä–æ–π –¥–≤–µ –∫–∞—Ä—Ç–æ—á–∫–∏ üôÇ");
    }, 650);
  }

  function finish(){
    stopTimer();
    const sec = startTs ? Math.floor((Date.now() - startTs)/1000) : 0;

    const prev = readBest();
    const cur = { moves, time: sec };
    const better = !prev || (cur.moves < prev.moves) || (cur.moves === prev.moves && cur.time < prev.time);
    if(better) writeBest(cur);
    showBest();

    setToast(`<b>–£—Ä–∞!</b> –í—Å–µ –ø–∞—Ä—ã —Å–æ–±—Ä–∞–Ω—ã üéâ<br/>–•–æ–¥—ã: <b>${moves}</b>, –≤—Ä–µ–º—è: <b>${formatTime(sec)}</b>`);
    fireConfetti();
  }

  function fireConfetti(){
    confetti.innerHTML = "";
    confetti.classList.add("on");
    const colors = ["#2f7dff","#ff3fbf","#12d98a","#ffb300","#7c5cff"];
    for(let i=0;i<70;i++){
      const d = document.createElement("div");
      d.className = "piece";
      d.style.left = (Math.random()*100) + "vw";
      d.style.top = (-20 - Math.random()*60) + "px";
      d.style.background = colors[Math.floor(Math.random()*colors.length)];
      d.style.animationDuration = (650 + Math.random()*500) + "ms";
      d.style.animationDelay = (Math.random()*300) + "ms";
      confetti.appendChild(d);
    }
    setTimeout(()=> confetti.classList.remove("on"), 1400);
  }

  async function newGame(){
    stopTimer();
    startTs = null;

    moves = 0;
    matched = 0;
    opened = [];
    lock = false;

    movesEl.textContent = "0";
    timeEl.textContent = "00:00";

    const cols = Number(sizeSel.value);
    const deck = buildDeck(cols);
    const usedIcons = Array.from(new Map(deck.map(d => [d.icon.url, d.icon])).values());

    cards = deck.map(x => ({...x, _matched:false}));

    pairsEl.textContent = `0/${Math.floor((cols*4)/2)}`;
    updateProgressUI();
    setToast("–û—Ç–∫—Ä–æ–π –¥–≤–µ –∫–∞—Ä—Ç–æ—á–∫–∏ üôÇ");
    showBest();

    await preloadIcons(usedIcons);
    render();
  }

  function hint(){
    if(lock) return;
    if(cards.length === 0) return;

    const toOpen = [];
    for(let i=0;i<cards.length;i++){
      if(!cards[i]._matched) toOpen.push(i);
    }
    const prev = opened.slice();
    opened = toOpen;
    render();
    setToast("–ü–æ–¥—Å–∫–∞–∑–∫–∞: –∑–∞–ø–æ–º–∏–Ω–∞–π! üëÄ");
    lock = true;
    setTimeout(() => {
      opened = prev.filter(i => !cards[i]._matched);
      lock = false;
      render();
      setToast("–û—Ç–∫—Ä–æ–π –¥–≤–µ –∫–∞—Ä—Ç–æ—á–∫–∏ üôÇ");
    }, 2000);
  }

  // —Å–æ–±—ã—Ç–∏—è
  newBtn.addEventListener("click", newGame);
  hintBtn.addEventListener("click", hint);
  sizeSel.addEventListener("change", newGame);
  resetBest.addEventListener("click", () => {
    localStorage.removeItem(bestKey());
    showBest();
    setToast("–†–µ–∫–æ—Ä–¥ —Å–±—Ä–æ—à–µ–Ω ‚úÖ");
  });

  // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å —Å–µ—Ç–∫—É –ø—Ä–∏ —Å–º–µ–Ω–µ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏/—Ä–∞–∑–º–µ—Ä–∞
  window.addEventListener("resize", () => { if(cards.length) render(); }, {passive:true});

  // –∑–∞–ø—É—Å–∫
  showBest();
  updateProgressUI();
  newGame();
})();
</script>
</body>
</html>
